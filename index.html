<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Title tester (124px / max 2 lines)</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<h1>Title tester (124px / max 2 lines)</h1>

<p>
    Type your translation directly in the preview tile below.
    It uses <strong>Roboto 15px / line-height 20px</strong>
    and fixed width <strong>124 px</strong>. If the text overflows to a 3rd line,
    please shorten it.
</p>

<div id="preview" class="preview" contenteditable="true"></div>

<div class="status" id="status">Waiting…</div>

<div class="metrics" id="metrics">Characters: 0 · Estimated lines: 1</div>

<h2>Guidelines</h2>
<ul>
    <li>Maximum <strong>2 lines</strong> inside 124 px width.</li>
    <li>Prefer <strong>up to 3 short words</strong>.</li>
    <li>Avoid very long compound words.</li>
    <li>If it doesn't fit: use a <strong>shorter alternative</strong>.</li>
</ul>

<script>
const preview = document.getElementById("preview");
const status  = document.getElementById("status");
const metrics = document.getElementById("metrics");

const PLACEHOLDER = "Type here…";
let isPristine = true; // пользователь ещё не начал ввод

function setPlaceholder() {
    isPristine = true;
    preview.textContent = PLACEHOLDER;
    preview.classList.add("placeholder");

    status.className = "status";
    status.textContent = "Waiting…";
    metrics.textContent = "Characters: 0 · Estimated lines: 1";
}

function clearPlaceholderIfNeeded() {
    if (!isPristine) return;
    isPristine = false;
    preview.textContent = "";
    preview.classList.remove("placeholder");
}

function update() {
    // когда показываем плейсхолдер, ничего не считаем
    if (isPristine) return;

    requestAnimationFrame(() => {
        const style = getComputedStyle(preview);
        const lineHeight    = parseFloat(style.lineHeight);
        const paddingTop    = parseFloat(style.paddingTop);
        const paddingBottom = parseFloat(style.paddingBottom);

        const rawHeight    = preview.scrollHeight;
        const contentHeight = rawHeight - paddingTop - paddingBottom;
        const lines = Math.max(1, Math.round(contentHeight / lineHeight));

        const text   = preview.innerText.trim();
        const length = text.length;

        if (length === 0) {
            // пользователь всё стёр — возвращаем плейсхолдер
            setPlaceholder();
            return;
        }

        if (lines <= 2) {
            status.className = "status ok";
            status.textContent = "✔ Fits in 2 lines";
        } else {
            status.className = "status warn";
            status.textContent = `✘ Too long (${lines} lines) — please shorten`;
        }

        metrics.textContent = `Characters: ${length} · Estimated lines: ${lines}`;
    });
}

// События
preview.addEventListener("focus", () => {
    clearPlaceholderIfNeeded();
});

preview.addEventListener("input", () => {
    clearPlaceholderIfNeeded();
    update();
});

// стартовое состояние
setPlaceholder();
</script>

</body>
</html>
