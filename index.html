<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Title tester (124px / max 2 lines)</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<h1>Title tester (124px / max 2 lines)</h1>

<p>
    Type your translation directly in the preview tile below. It uses
    <strong>Roboto 15px / line-height 20px</strong> and fixed width
    <strong>124 px</strong>. If the text overflows to a 3rd line, please shorten it.
</p>

<!-- Видимый тайл для переводчиков -->
<div id="preview" class="preview" contenteditable="true"></div>

<!-- Скрытый близнец только для измерения высоты текста -->
<div id="measure" class="preview preview-measure" aria-hidden="true"></div>

<div id="status" class="status">Waiting...</div>

<div id="metrics" class="metrics">
    Characters: 0 · Estimated lines: 1 · Longest word: 0
</div>

<h2>Guidelines</h2>
<ul>
    <li>Maximum <strong>2 lines</strong> inside 124 px width.</li>
    <li>Prefer <strong>up to 3 short words</strong>.</li>
    <li>Avoid very long compound words (more than ~14 characters).</li>
    <li>If it doesn't fit: use a <strong>shorter alternative</strong>.</li>
</ul>

<script>
(function () {
    const preview  = document.getElementById("preview");
    const measure  = document.getElementById("measure");
    const status   = document.getElementById("status");
    const metrics  = document.getElementById("metrics");

    const LINE_HEIGHT = 20;           // px, как в дизайне
    const LONG_WORD_LIMIT = 14;       // длина слова для жёлтого предупреждения

    let isPlaceholder = true;

    function setPlaceholder() {
        isPlaceholder = true;
        preview.classList.add("placeholder");
        preview.textContent = "Type here…";
        update(true); // считать как пустое поле
    }

    function clearPlaceholder() {
        if (!isPlaceholder) return;
        isPlaceholder = false;
        preview.classList.remove("placeholder");
        preview.textContent = "";
    }

    function getText() {
        if (isPlaceholder) return "";
        return preview.textContent.replace(/\u200B/g, "").trim();
    }

    function update(forceEmpty) {
        let text = forceEmpty ? "" : getText();

        // Обновляем скрытый измеритель
        measure.textContent = text || " "; // чтобы высота не была 0

        const height = measure.scrollHeight;
        let lines = Math.round(height / LINE_HEIGHT);
        if (!text) {
            lines = 1; // пустое поле считаем как 1 строку
        }

        const chars = text.length;

        // Находим самое длинное слово
        let longestWord = 0;
        if (text) {
            const words = text.split(/\s+/).filter(Boolean);
            longestWord = words.reduce((max, w) => Math.max(max, w.length), 0);
        }

        // Состояние и сообщение
        if (!text) {
            status.className = "status";
            status.textContent = "Waiting...";
        } else if (lines > 2) {
            status.className = "status status-error";
            status.textContent = `✘ Too long (${lines} lines) — please shorten`;
        } else if (longestWord > LONG_WORD_LIMIT) {
            status.className = "status status-warn";
            status.textContent =
                "✔ Fits in 2 lines, but contains a very long word — shorten if possible.";
        } else {
            status.className = "status status-ok";
            status.textContent = "✔ Fits in 2 lines";
        }

        metrics.textContent =
            `Characters: ${chars} · Estimated lines: ${lines} · Longest word: ${longestWord}`;
    }

    // Слушатели
    preview.addEventListener("focus", () => {
        clearPlaceholder();
    });

    preview.addEventListener("blur", () => {
        if (!getText()) {
            setPlaceholder();
        }
    });

    preview.addEventListener("input", () => update(false));

    // Стартовое состояние
    setPlaceholder();
})();
</script>

</body>
</html>
