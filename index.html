<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Title tester (124px / max 2 lines)</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<h1>Title tester (124px / max 2 lines)</h1>

<p>
    Type your translation directly in the preview tile below. It uses
    <strong>Roboto 15px / line-height 20px</strong> and fixed width
    <strong>124 px</strong>. If the text overflows to a 3rd line, please shorten it.
</p>

<div id="preview" class="preview" contenteditable="true"></div>

<div class="status" id="status">Waiting...</div>

<div class="metrics" id="metrics">
    Characters: 0 · Estimated lines: 1 · Longest word: 0
</div>

<h2>Guidelines</h2>
<ul>
    <li>Maximum <strong>2 lines</strong> inside 124 px width.</li>
    <li>Prefer <strong>up to 3 short words</strong>.</li>
    <li>Avoid very long compound words (more than ~14 characters).</li>
    <li>If it doesn't fit: use a <strong>shorter alternative</strong>.</li>
</ul>

<script>
const preview = document.getElementById("preview");
const status  = document.getElementById("status");
const metrics = document.getElementById("metrics");

const PLACEHOLDER = "Type here…";
const LONG_WORD_LIMIT = 14;

// ----- placeholder helpers -----
function showPlaceholder() {
    preview.textContent = PLACEHOLDER;
    preview.classList.add("placeholder");

    status.className = "status";
    status.textContent = "Waiting...";
    metrics.textContent =
        "Characters: 0 · Estimated lines: 1 · Longest word: 0";
}

function hidePlaceholder() {
    if (preview.classList.contains("placeholder")) {
        preview.textContent = "";
        preview.classList.remove("placeholder");
    }
}

// ----- main update -----
function update() {
    // если сейчас показывается плейсхолдер — просто выходим
    if (preview.classList.contains("placeholder")) {
        return;
    }

    requestAnimationFrame(() => {
        const text = preview.innerText.trim();

        if (text.length === 0) {
            showPlaceholder();
            return;
        }

        const style         = getComputedStyle(preview);
        const lineHeight    = parseFloat(style.lineHeight);
        const paddingTop    = parseFloat(style.paddingTop);
        const paddingBottom = parseFloat(style.paddingBottom);

        const rawHeight     = preview.scrollHeight;
        const contentHeight = rawHeight - paddingTop - paddingBottom;
        const lines         = Math.max(1, Math.round(contentHeight / lineHeight));

        // поиск самого длинного слова
        const words = text.split(/\s+/).filter(Boolean);
        let longestWord = 0;
        for (const w of words) {
            if (w.length > longestWord) longestWord = w.length;
        }

        if (lines > 2) {
            status.className = "status warn";
            status.textContent =
                `✘ Too long (${lines} lines) — please shorten`;
        } else if (longestWord > LONG_WORD_LIMIT) {
            status.className = "status warn-soft";
            status.textContent =
                "✔ Fits in 2 lines, but contains a very long word — shorten if possible.";
        } else {
            status.className = "status ok";
            status.textContent = "✔ Fits in 2 lines";
        }

        metrics.textContent =
            `Characters: ${text.length} · Estimated lines: ${lines} · Longest word: ${longestWord}`;
    });
}

// события
preview.addEventListener("focus", () => {
    hidePlaceholder();
});

preview.addEventListener("blur", () => {
    const text = preview.innerText.trim();
    if (!text.length) {
        showPlaceholder();
    }
});

preview.addEventListener("input", () => {
    update();
});

// старт
showPlaceholder();
</script>

</body>
</html>
